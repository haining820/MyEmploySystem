<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <script src="./static/js/jquery-3.6.0.js"></script>
    <link rel="stylesheet" href="./static/js/layui/css/layui.css">
    <link rel="stylesheet" href="./static/css/login.css">
</head>
<body>
<div class="wrap">

    <img src="./static/img/1.jpg" class="imgStyle">

    <div class="loginForm">
        <form>
            <div class="logoHead">
                <h2 style="margin-top: 15px">&nbsp;&nbsp;大学生模拟招聘系统</h2>
            </div>
            <div class="usernameWrapDiv">
                <div class="usernameLabel">
                    <label>账&nbsp;&nbsp&nbsp;号:</label>
                </div>
                <div class="usernameDiv">
                    <i class="layui-icon layui-icon-username adminIcon"></i>
                    <input id="loginAccountNum" class="layui-input adminInput" type="text" name="loginAccountNum"
                           placeholder="请输入账号">
                </div>
            </div>
            <div class="usernameWrapDiv">
                <div class="usernameLabel">
                    <label>密&nbsp;&nbsp;&nbsp;码:</label>
                </div>
                <div class="passwordDiv">
                    <i class="layui-icon layui-icon-password adminIcon"></i>
                    <input id="loginPassword" class="layui-input adminInput" type="password" name="loginPassword"
                           placeholder="请输入密码">
                </div>
            </div>
            <div class="usernameWrapDiv">
                <div class="usernameLabel">
                    <label>验证码:</label>
                </div>
                <div class="cardDiv">
                    <input id="loginCard" class="layui-input cardInput" type="text" name="loginCard"
                           placeholder="请输入验证码">
                </div>
                <div class="codeDiv">
                    <input id="loginCode" class="layui-input codeInput" type="button">
                </div>
            </div>
            <div class="usernameWrapDiv">
                <div class="submitLabel">
                    <label>没有账号？<a href="#" id="loginRegister">点击注册</a></label>
                </div>
                <div class="submitDiv">
                    <input id="loginBtn" type="button" class="submit layui-btn layui-btn-primary" value="登录"></input>
                </div>
            </div>
        </form>
    </div>

    <div id="register-com-layer" style="display: none; padding: 20px 50px">
        <form id="register-form" class="layui-form layui-form-pane" lay-filter="register-form">
            <!--comId,comAccountNum,comPwd默认不显示-->
            <div class="layui-form-item">
                <label class="layui-form-label">账号</label>
                <div class="layui-input-inline">
                    <input type="number" name="comAccountNum" lay-verify="required" autocomplete="off" class="layui-input" style="width:280px;">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" style="">登录密码</label>
                <div class="layui-input-inline">
                    <input type="text" name="comPwd" lay-verify="required" autocomplete="off" class="layui-input" style="width:280px;">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-block">
                    <input type="text" name="comUserName" class="layui-input" lay-verify="required" autocomplete="off" style="width:280px;">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">所属公司</label>
                <div class="layui-input-block">
                    <input type="text" name="comName" class="layui-input" lay-verify="required" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label" style="width:800px">公司介绍</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" name="comIntro" class="layui-textarea" style="width:800px; height:120px"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">地址</label>
                <div class="layui-input-block">
                    <input type="text" name="comAddress" class="layui-input" lay-verify="required" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">电子邮箱</label>
                <div class="layui-input-block">
                    <input type="text" name="comEmail" class="layui-input" lay-verify="email" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">联系电话</label>
                <div class="layui-input-block">
                    <input type="text" name="comTel" class="layui-input" lay-verify="number" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">公司网址</label>
                <div class="layui-input-block">
                    <input type="text" name="comWeb" class="layui-input" lay-verify="required" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <br>
                    <button class="layui-btn" lay-submit lay-filter="register-com-form-submit">注册</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button class="layui-btn" type="button" id="com-exit">取消</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>

    <div id="register-em-layer" style="display: none; padding: 20px 50px">
        <form id="update-em-form" class="layui-form layui-form-pane" lay-filter="update-em-form">
            <!--emId,emAccountName,emPwd默认不显示-->
            <div class="layui-form-item">
                <label class="layui-form-label">账号</label>
                <div class="layui-input-inline">
                    <input type="text" name="emAccountNum" lay-verify="number" autocomplete="off" class="layui-input" style="width:280px;">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" style="">登录密码</label>
                <div class="layui-input-inline">
                    <input type="text" name="emPwd" lay-verify="required" autocomplete="off" class="layui-input" style="width:280px;">
                </div>
            </div>

            <div class="layui-form-item" >
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-inline">
                    <input type="text" name="emUsername" class="layui-input" lay-verify="required" autocomplete="off" style="width:280px">
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="emName" class="layui-input" lay-verify="required" autocomplete="off" style="width:280px;">
                    </div>
                </div>
                <div class="layui-inline" style="padding-left: 90px">
                    <label class="layui-form-label" style="">性别</label>
                    <div class="layui-input-inline">
                        <input type="text" name="emSex" class="layui-input" lay-verify="required" autocomplete="off" style="width:280px;">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">生日</label>
                <div class="layui-input-inline">
                    <input type="text" name="emBirth" class="layui-input" lay-verify="required" autocomplete="off" style="width:692px">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">就读院校</label>
                <div class="layui-input-inline">
                    <input type="text" name="emSchool" class="layui-input" lay-verify="required" autocomplete="off"style="width:692px">
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label" style="width:800px">自我介绍</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" name="emIntro" class="layui-textarea" style="width:800px; height:120px"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-inline">
                    <input type="text" name="emEmail" class="layui-input" lay-verify="email" autocomplete="off" style="width:692px">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">联系电话</label>
                <div class="layui-input-inline">
                    <input type="text" name="emTel"  class="layui-input" lay-verify="number" autocomplete="off" style="width:692px">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">毕业时间</label>
                <div class="layui-input-inline">
                    <input type="text" name="emGraduateTime" class="layui-input" lay-verify="date" placeholder="请按正确格式（年-月）输入，如：2021-9" autocomplete="off" style="width:692px">
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <br>
                    <button class="layui-btn" lay-submit lay-filter="register-em-form-submit">注册</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button class="layui-btn" type="button" id="em-exit">取消</button>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

        </form>
    </div>

</div>
<script src="./static/js/layui/layui.js" type="text/javascript"></script>
<script>
    layui.use(['layer'], function () {
        var layer = layui.layer;
    })
    $(function () {
        // 页面初始化生成验证码
        window.onload = createCode('#loginCode');
        // 验证码切换
        $('#loginCode').click(function () {
            createCode('#loginCode');
        });
        // 登陆事件
        $('#loginBtn').click(function () {
            login();
        });
        // 注册事件
        $('#loginRegister').click(function () {
            register();
        });
    });

    // 生成验证码
    function createCode(codeID) {
        var code = "";
        // 验证码长度
        var codeLength = 4;
        // 验证码dom元素
        var checkCode = $(codeID);
        // 验证码随机数
        var random = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',
            'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
        for (var i = 0; i < codeLength; i++) {
            // 随机数索引
            var index = Math.floor(Math.random() * 36);
            code += random[index];
        }
        // 将生成的随机验证码赋值
        checkCode.val(code);
    }

    // 校验验证码、用户名、密码
    function validateCode(inputID, codeID) {
        var inputCode = $(inputID).val().toUpperCase();
        var cardCode = $(codeID).val();
        var loginAccountNum = $('#loginAccountNum').val();
        var loginPassword = $('#loginPassword').val();
        if ($.trim(loginAccountNum) == '' || $.trim(loginAccountNum).length <= 0) {
            layer.alert("账号不能为空！");
            return false;
        }
        if ($.trim(loginPassword) == '' || $.trim(loginPassword).length <= 0) {
            layer.alert("密码不能为空！");
            return false;
        }
        if (inputCode.length <= 0) {
            layer.alert("验证码不能为空！");
            return false;
        }
        if (inputCode != cardCode) {
            layer.alert("请输入正确验证码！");
            createCode('#loginCode');
            return false;
        }
        return true;
    }

    // 登录流程
    function login() {
        if (!validateCode('#loginCard', '#loginCode')) {
            //阻断提示
        } else {
            var loginAccountNum = $('#loginAccountNum').val();
            var loginPassword = $('#loginPassword').val();
            var params = {};
            params.loginAccountNum = loginAccountNum;
            params.loginPassword = loginPassword;
            var loginLoadIndex = layer.load(2);
            $('#loginBtn').val("正在登录...");
            $.ajax({
                type: 'post',
                // window.location.protocol+'//'+window.location.host+'/security-web/login.do',
                url: '/user/login',
                data: JSON.stringify(params),
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data) {
                    layer.close(loginLoadIndex);
                    console.log(data);

                    /*var testData = '{\"code\":\"999\"}';  //字符串
                    console.log(testData);
                    console.log(JSON.parse(testData));  //Object

                    var jsonData = JSON.parse(data);  //JSON.parse(Object),报错,已经是Object对象了
                    console.log(jsonData);

                    var jsonStr = JSON.stringify(data);*/

                    if (data.code == 1) {
                        window.location.href = '../main.html?loginId=' + data.loginId;
                    } else if (data.code == 2) {
                        window.location.href = '../main.html?loginId=' + data.loginId;
                    } else if (data.code == 3) {
                        window.location.href = '../main.html?loginId=' + data.loginId;
                    } else {
                        layer.close(loginLoadIndex);
                        layer.msg('密码错误！');
                        console.log("登录失败！data.code="+data.code);
                    }
                },
                error: function () {
                    layer.close(loginLoadIndex);
                    layer.msg('密码错误！');
                    console.log("登录失败！");
                    $('#loginBtn').val("登录");
                }
            });
        }

    }

    // 注册流程
    function register() {
        //询问框
        /*layer.open({
            title: '请问您是？',
            btn:['我是招聘者','我是求职者'],
            btn1:function(index,layero){
                layer.open({
                    type: 1,
                    title: '注册新用户-招聘者',
                    skin: 'layui-layer-molv',
                    area: ['900px','600px'],
                    content: $('#register-com-layer')
                });
            },
            btn2:function(index,layero){
                layer.open({
                    type: 1,
                    title: '注册新用户-求职者',
                    skin: 'layui-layer-molv',
                    area: ['900px','600px'],
                    content: $('#register-em-layer')
                });
                return false;
            }
        });*/

        layer.confirm('请问您是？', {
            title: '请选择注册身份',
            btn: ['我是招聘者','我是求职者'] //按钮
        }, function(){
            // layer.msg('的确很重要', {icon: 1});
            layer.open({
                type: 1,
                title: '注册新用户-招聘者',
                skin: 'layui-layer-molv',
                area: ['900px','600px'],
                content: $('#register-com-layer')
            });

            layui.form.on('submit(register-com-form-submit)', function (data) {
                // ajax方式更新用户
                $.ajax({
                    url: "/edit/addCom",
                    type: "POST",
                    data: JSON.stringify(data.field),
                    contentType: "application/json; charset=utf-8",
                    dataType: 'json',
                    success: function (data) {
                        if (data.status == 1) {
                            layer.close(layer.index);
                            layer.msg('注册成功！',{icon:1,time:1000, shift: 1},function () {
                                location.reload();
                            });
                        } else {
                            layer.msg('注册失败，请重试！');
                        }
                    },
                    error: function () {
                        console.log("ajax error");
                    }
                });
                // 阻止表单跳转
                return false;
            });

            $('body').on('click','#com-exit',function(){
                layer.close(layer.index);
            })
        }, function(){
            layer.open({
                type: 1,
                title: '注册新用户-求职者',
                skin: 'layui-layer-molv',
                area: ['900px','600px'],
                content: $('#register-em-layer')
            });

            layui.form.on('submit(register-em-form-submit)', function(data) {
                // ajax方式添加用户
                $.ajax({
                    url: "/edit/addEm",
                    type: "POST",
                    data: JSON.stringify(data.field),
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function(data) {
                        if (data.status == 1) {
                            layer.close(layer.index);
                            layer.msg('注册成功！',{icon:1,time:1000, shift: 1},function () {
                                location.reload();
                            });
                        } else {
                            layer.msg('注册失败，请重试！');
                        }
                    },
                    error: function() {
                        console.log("ajax error");
                    }
                });
                // 阻止表单跳转
                return false;
            });

            $('body').on('click','#em-exit',function(){
                layer.close(layer.index);
            })

            return false;
        });

        /*layer.open({
            type: '1',
            content: $('.registerPage'),
            title: '注册',
            area: ['800px', '500'],
            btn: ['注册', '重置', '取消'],
            closeBtn: '1',
            btn1: function (index, layero) {
                //注册回调
                layer.close(index);
                var registerUsername = $('#registerUsername').val();
                var registerPassword = $('#registerPassword').val();
                var registerWellPassword = $('#registerWellPassword').val();
                var selectValue = $('#roleSelect option:selected').val();
                var params = {};
                params.registerUsername = registerUsername;
                params.registerPassword = registerPassword;
                params.registerWellPassword = registerWellPassword;
                params.selectValue = selectValue;
                var registerLoadIndex = layer.load(2);
                $.ajax({
                    type: 'post',
                    url: window.location.protocol + '//' + window.location.host + '/security-web/register.do',
                    dataType: 'json',
                    data: JSON.stringify(params),
                    contentType: 'application/json',
                    success: function (data) {
                        layer.close(registerLoadIndex);
                        layer.msg(data);
                    },
                    error: function () {
                        layer.close(registerLoadIndex);
                        layer.alert("请求超时！")
                    }
                });
            },
            btn2: function (index, layero) {
                //重置回调
                var registerUsername = $('#registerUsername').val("");
                var registerPassword = $('#registerPassword').val("");
                var registerWellPassword = $('#registerWellPassword').val("");
                // 防止注册页面关闭
                return false;
            },
            btn3: function (index, layero) {
                //取消回调
            }
        })*/
    }

</script>

</body>



</html>
